#!/bin/sh
#Удалите текущие правила и цепочки в iptables
# iptables -F
iptables --flush
iptables --delete-chain

##INPUT
#разрешить обратную связь
iptables -A INPUT -i lo -j ACCEPT
#разрешить установленные подключения
# iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
#разрешить SSH или какой-нибудь другой TCP порт
iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 9027 -j ACCEPT
# iptables -A INPUT -p tcp --dport 9027 -j ACCEPT
#разрешить UDP на порту 22
iptables -A INPUT -m state --state NEW -p udp --dport 9027 -j ACCEPT

# iptables -A INPUT -i lo -p udp -s 127.0.0.1 -d 127.0.1.1 --sport 40000:65535 --dport 53 -m limit --limit 50/s -j ACCEPT
# iptables -A INPUT -i lo -p udp -d 127.0.0.1 -s 127.0.1.1 --dport 40000:65535 --sport 53 -m limit --limit 50/s -j ACCEPT
iptables -A INPUT -p udp -s 8.8.4.4 --sport 53 -m limit --limit 50/s -j ACCEPT
iptables -A INPUT -p udp -s 8.8.8.8 --sport 53 -m limit --limit 50/s -j ACCEPT
iptables -A INPUT -p tcp -m multiport --sports 443,80 -m state --state NEW,ESTABLISHED -m limit --limit 50/s -j ACCEPT

##OUTPUT
#разрешить обратную связь
iptables -A OUTPUT -o lo -j ACCEPT
iptables -A OUTPUT -p tcp -m multiport --dports 80,443 -j ACCEPT

#политики по умолчанию
iptables -P INPUT DROP
iptables -P OUTPUT DROP
# iptables -P FORWARD DROP
#Сохранить
iptables-save
